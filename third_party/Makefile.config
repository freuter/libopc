#
# This file is used to generate the config files needed by Makefile.xml
#

.PHONY: all libxml lib clean

#BUILDDIR=../config
LOCALDIR=$(abspath ${BUILDDIR}/local)
ZLIB_VERSION=zlib-1.2.5
LIBXML_VERSION=libxml2-2.7.7
MACHINE=$(shell $(CC) -dumpmachine)
ZLIB_CONFIG=$(abspath ${BUILDDIR}/${MACHINE}/${ZLIB_VERSION})
LIBXML_CONFIG=$(abspath ${BUILDDIR}/${MACHINE}/${LIBXML_VERSION})

all: zlib libxml
	@echo build config for ${MACHINE}


zlib: ${ZLIB_VERSION}/configure
	@mkdir -p ${ZLIB_CONFIG}
	@mkdir -p ${BUILDDIR}
	@rm -rf ${BUILDDIR}/${ZLIB_VERSION}
	@cp -r ${ZLIB_VERSION} ${BUILDDIR}
	@pushd ${BUILDDIR}/${ZLIB_VERSION} && \
	./configure --prefix=${LOCALDIR} && \
        cp zconf.h ${ZLIB_CONFIG} && \
	popd

#                    --with-debug
#--with-mem-debug 
#--with-run-debug

libxml: ${LIBXML_VERSION}/configure
	@mkdir -p ${LIBXML_CONFIG}/libxml
	@mkdir -p ${BUILDDIR}
	@rm -rf ${BUILDDIR}/${LIBXML_VERSION}
	@cp -r ${LIBXML_VERSION} ${BUILDDIR}
	@pushd ${BUILDDIR}/${LIBXML_VERSION} && \
        ./configure --prefix=${LOCALDIR} \
                    --without-c14n \
                    --without-catalog \
                    --without-docbook  \
                    --without-fexceptions \
                    --without-ftp \
                    --without-history  \
                    --without-html \
                    --without-http \
                    --without-iconv \
                    --without-iso8859x \
                    --without-legacy \
                    --without-output \
                    --without-pattern \
                    --without-push \
                    --without-python \
                    --with-reader \
                    --without-regexps \
                    --without-sax1 \
                    --without-schemas \
                    --without-schematron \
                    --without-threads \
                    --without-tree \
                    --without-valid \
                    --with-writer \
                    --without-xinclude \
                    --without-xpath \
                    --without-xptr \
                    --without-modules \
                    --without-zlib && \
        cp config.h ${LIBXML_CONFIG} && \
        cp include/libxml/xmlversion.h ${LIBXML_CONFIG}/libxml && \
        popd

clean:
	rm -rf ${LOCALDIR}
	rm -rf ${BUILDDIR}/${ZLIB_VERSION}
	rm -rf ${BUILDDIR}/${LIBXML_VERSION}
